---
layout: page.html
---

<h1>Instant, themed Twitch chat overlays</h1>
<div class="col-2">
	<form id="overlay-builder">
		<label for="channel">Channel name</label>
		<input type="text" id="channel" name="channel" required="true" autocomplete="off" autocorrect="off"
			autocapitalize="off" spellcheck="false" placeholder="{{defaults.channel}}"
			title="Your Twitch channel name" />

		<div class="builder-header">
			<label for="theme">Theme</label>
			<a href="docs/configuration/#theme" aria-label="Docs for theme">?</a>
		</div>
		<select id="theme" name="theme">
			<option value="{{defaults.theme}}">{{defaults.theme | formatThemeName}}</option>
			<option value="light">Light</option>
			{%- for theme in themes.list -%}
			{%- unless theme == "default" or theme == "light" -%}
			<option value="{{ theme }}">{{ theme | formatThemeName }}</option>
			{%- endunless -%}
			{%- endfor %}
		</select>

		<div class="builder-header">
			<label for="hide-messages-from">Hide messages from</label>
			<a href="docs/configuration/#hide-messages-from" aria-label="Docs for hideMessagesFrom">?</a>
		</div>
		<input type="text" id="hide-messages-from" name="hideMessagesFrom" autocomplete="off" autocorrect="off"
			autocapitalize="off" spellcheck="false" pattern="^[\w-]+(,[\w-]+)*$"
			title="Comma seperated list of usernames to hide messages from" />

		<fieldset>
			<div class="builder-header">
				<legend>Show commands</legend>
				<a href="docs/configuration/#show-commands" aria-label="Docs for showCommands">?</a>
			</div>

			<input type="radio" id="show-commands-true" name="showCommands" value="true" />
			<label for="show-commands-true">true</label>

			<input type="radio" id="show-commands-default" name="showCommands" value="{{defaults.showCommands}}"
				checked="true" />
			<label for="show-commands-default">{{defaults.showCommands}}</label>
		</fieldset>

		<div class="builder-header">
			<label for="show-latest-messages">Show latest messages</label>
			<a href="docs/configuration/#show-latest-messages" aria-label="Docs for showLatestMessages">?</a>
		</div>
		<input type="number" id="show-latest-messages" name="showLatestMessages"
			value="{{defaults.showLatestMessages}}" />

		<button type="submit" style="margin-top: 1em">Get my URL!</button>

		<div>
			<output></output>
		</div>
	</form>

	<iframe id="preview" src="/c/{{defaults.channel}}?DEMO=true" frameborder="0" allowtransparency="true">
	</iframe>
</div>
<script>
	const { channel: defaultChannel, ...defaultQueryParameters } = JSON.parse(`{{defaults | serialize }}`);
	const overlayBuilderForm = document.getElementById('overlay-builder');
	const linkOutput = document.querySelector('output');
	const preview = document.getElementById('preview');
	const allFields = document.querySelectorAll('[name]');
	overlayBuilderForm.addEventListener('submit', handleSubmit);
	allFields.forEach((field) => field.addEventListener('change', updatePreview));

	/**
	 * @param {Event} event - The form submit event
	 */
	function handleSubmit(event) {
		event.preventDefault();
		let partialURL = buildPartialURL();
		linkOutput.innerHTML = `<strong>showmy.chat/c/</strong>${partialURL}`;
	}

	/**
	 * Reroutes the preview iframe to a preview using current form selections.
	 */
	function updatePreview() {
		let partialURL = buildPartialURL(true);
		preview.contentWindow.location = `/c/${partialURL}`;
	}

	/**
	 * @param {boolean} isDemo - build url for demo purposes?
	 * @returns {string} partialUrl - url after /c/ path
	 */
	function buildPartialURL(isDemo) {
		const values = new FormData(overlayBuilderForm);

		// remove all parts of the url that are not query parameters
		const channelName = values.get('channel') || defaultChannel;
		values.delete('channel');

		// prevent defaults from being explicitly set in the url
		for (let [key, value] of Object.entries(defaultQueryParameters)) {
			if (value === false) {
				value = "false";
			}
			if (values.get(key) == value) {
				values.delete(key);
			}
		}

		if (isDemo) {
			values.set('DEMO', 'true');
		}

		const queryParams = new URLSearchParams(values).toString();
		const paramString = queryParams ? `?${queryParams}` : '';

		return `${channelName}${paramString}`;
	}
</script>
<style>
	:root {
		color-scheme: light dark;
	}

	.col-2 {
		display: flex;
		gap: 4em;
	}

	.col-2 > * {
		width: 50%;
	}

	#preview {
		min-height: 30em;
		height: 100%;
		background: transparent;
		background: var(--code-background-color);
		position: sticky;
		top: 3em;
		resize: both;
	}

	.builder-header {
		display: flex;
		justify-content: space-between;
	}

	@media (max-width: 576px) {
		.col-2 {
			flex-direction: column;
		}

		.col-2 > * {
			width: 100%;
		}
	}
</style>